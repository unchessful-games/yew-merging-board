\documentclass{article}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage[russian]{babel}
\usepackage[style=gost-numeric]{biblatex}
\usepackage{graphicx}

\addbibresource{citations.bib}

\title{Анализ игровых стратегий}

\begin{document}
\maketitle

\section{Введение}

\subsection{История шахмат}

Шахматы -- одна из самых старых настольных игр, которая популярна до сих пор.
В близком к современному виду, шахматы существуют с 1475 годов~\cite{world_of_chess},
и начиная с XIX века они были стандартизированны организациями вроде Международной
Шахматной Федерации (ФИДЕ). Ввиду своей большой истории и высокой сложности, шахматы -- 
одна из самых глубоко анализированных игр. Из-за этого шахматы хорошо подходят 
как основа работы по анализу стратегических игр.

В базовом виде шахматы -- это игра для двух игроков,
которые выполняют один ход одной из фигур своего цвета. 
В начале игры фигуры располагаются на квадратной доске с 8x8 клетками,
где на второй и седьмой горизонтали расположены 8 пешек,
а на первой и восьмой -- остальные фигуры в определенном порядке.
Таковы правила ФИДЕ для международных шахмат~\cite{fide-laws},
но, как мы увидим, есть много вариантов игры,
в которых нарушаются каждое из этих правил.

\subsection{Компьютерные шахматы и другие стратегические игры}

Работа над разработкой автоматов, которые бы играли в шахматы,
велась ещё до изобретения цифровых компьютеров.
\footnote{Самое знаменитое устройство в этой сфере, так называемый <<механический турк>>~\cite{mechturk},
посредством иллюзионных приемов содержал человека-шахматиста,
и поэтому не считается настоящим автоматом.}
Но из-за механической природы они были очень ограничены в своих возможностях:
так, \emph{El Ajedrecista} -- автомат, который был построен в 1912 году~\cite{ajedrecista-article}
и реализовывал простой алгоритм~\cite{ajedrecista-algo}, который играет королем и ладьей
и всегда находит мат против одного короля.
Этот алгоритм можно описать всего сотней строк кода на языке программирования,
но из-за того, что это было реализовано электромеханически,
его размер был слишком большим,
чтобы таким образом реализовать какие-либо более сложные алгоритмы.

Самая ранняя компьютерная программа, которая играет в шахматы --
\emph{Turochamp}, которая была разработана в 1948 году 
и называется по именам своих двух авторов -- Алана Тьюринга и Дейвида Чамперновна~\cite{turochamp}.
Хотя Тьюринг не дожил до того времени, когда этот алгоритм можно было бы запустить на физическом компьютере,
он симулировал этот алгоритм вручную, чтобы играть против человека,
проиграв ему за 29 ходов,
где каждый из ходов вычислялся за 30 минут. 
Несмотря на это, этот алгоритм был успешно воплощен в компьютерных программах,
в том числе для веб-браузера~\cite{nimturochamp}.


Turochamp -- первая программа, которая использует алгоритм \emph{minimax},
который сейчас является основой большинства алгоритмов для игр с нулевой суммой
(то есть таких, что если один игрок выигрывает, то другой проигрывает).
Его базовая идея состоит в том,
что я хочу сделать позицию максимально выигрышной для себя,
а мой противник -- максимально проигрышной для меня.
Сначала определяется какая-то метрика, называемая \emph{evaluation},
которая выводит число, описывающее, насколько текущая позиция выигрышна.
Алгоритм рассматривает все возможные свои ходы из текущей позиции,
затем для каждой из результирующих позиций рассматривает возможные ответы противника,
и так далее ищет по дереву игры.
Когда ход у алгоритма, из этого дерева выбирается такой ход,
у которого evaluation \emph{макс}имальный,
а для ходов противника выбирается \emph{мин}имальный evaluation --
поэтому этот алгоритм называется \emph{minimax}.
После поиска выбирается такой из ходов,
который в перспективе дает наилучший evaluation,
даже если противник всегда выбирает лучший ход.

Из-за того, что в среднем количество возможных ходов в шахматной позиции
(так называемый \emph{branching factor})
в среднем около 30~\cite{chess-se-branching-factor},
делать полноценный поиск очень трудно:
уже после трех ходов (или 6 полуходов: один ход в шахматах состоит из одного полухода белых и одного полухода черных)
количество листовых ходов для рассмотрения составляет 729 миллионов.
Для того, чтобы сократить это количество,
используются различные эвристики: самая популярная из них называется \emph{alpha-beta pruning},
и она позволяет игнорировать те части дерева, которые не обещают никакого улучшения позиции.
Для этого хранятся два значения: \emph{alpha} и \emph{beta},
соответственно минимальный evaluation, который может получить тот игрок, который пытается максимизировать его,
и максимальный evaluation, который может получить тот игрок, который пытается минимизировать его.
С помощью этих значений алгоритм игнорирует все ветви,
в которых значение не будет меньше \emph{alpha} или больше \emph{beta}.
Это позволяет рассматривать гораздо меньшее поддерево всех возможных ходов,
размер которого в среднем составляет логарифм от размера исходного дерева.
Более того, такой алгоритм никогда не пропускает наилучший ход в данной позиции.

\subsection{Evaluation-функции}

Для того, чтобы такой алгоритм поиска работал правильно,
нужно иметь хорошую evaluation-функцию:
такую, которая качественно определяет степень,
в которой текущая позиция выигрышна.
Самые базовые функции используют в основном баланс \emph{материала} в позиции:
какие именно фигуры есть у одного и другого игрока.
Традиционное соотношение фигур и их ценности,
изначально приведенное в XVIII веке,
назначет пешке стоимость в один балл,
коню и слону -- 3 балла,
ладье -- 5 баллов
и ферзю -- 9 баллов.

Многие evaluation-функции также добавляют бонусы за \emph{мобильность},
чтобы фигуры предпочитали находиться в таких позициях,
где у них много доступных ходов.
Такие подходы называются \emph{hand-crafted evaluation} (\emph{HCE}),
потому что результирующая функция целиком сделана и настроена человеком.

Один из компонентов многих evaluation-функций является
так называемые \emph{piece-square tables} (<<таблицы фигур-клеток>>).
Это -- таблица, которая содержит число, которое описывает,
насколько предпочтительно каждому виду фигуры находиться на этой клетке~\footnote{
    Часто используют две таких таблицы: одну для дебютных позиций,
    а вторую для эндшпиля.
    В зависимости от материала на доске
    можно делать интерполяцию между двумя этими позициями,
    что дает возможность плавно варьировать стратегию.
}.

Такие таблицы могут быть написаны вручную,
чтобы закодировать базовые идеи:
например, таблица для пешек будет иметь одинаковые значения в каждой горизонтали,
которые повышаются от одного края доски к другому,
потому что пешкам стоит продвигаться в ферзи.
Аналогично, коням и ферзям стоит находиться в центре доски,
чтобы обеспечить наибольшую мобильность,
поэтому их таблица будет иметь приоритет к центру доски.

Эти таблицы также могут быть оптимизированны с помощью компьютерного поиска,
например алгоритмом вроде \emph{Texel's Tuning Method}~\cite{texel-tuning}.
Этот подход сначала собирает статистику из большого количества игр
между оптимизируемым движком и его предыдущей версией,
а затем использует степень ошибки для того, чтобы найти градиент каждого из параметров функции evaluation
и изменить его в соответствии с ним.
Такой процесс можно повторять несколько раз,
чтобы найти локальный минимум ошибки.

Улучшением этого подхода было использовать много piece-square tables
в зависимости от расположения короля на доске. 
Используя эту идею, в 2018 году Юу Насу предложил новую нейросетевую архитектуру,
названную \reflectbox{EUNN} (\emph{efficiently updatable neural networks})~\cite{nnue-paper}.
Такая нейросеть принимает на вход состояние доски и возвращает одно число -- evaluation
для текущей позиции.
Инновацией в этой архитектуре стала высокая степень параметризации входного слоя:
там есть несколько копий наборов нейронов, которые описывают позицию фигур на доске,
в зависимости от текущего положения королей на доске.
Как результат, большое количество нейронов входного слоя 
не используются для вычисления одной позиции,
и благодаря этому можно обновлять каждую долю этих нейронов без необходимости
обновлять все вместе --
это позволяет эффективно распределять эти вычисления на много разных компьютеров,
работающих над этим асинхронно.
Также, эта сеть разработана специально для оптимальной производительности
при расчете на CPU,
и скрытые слои имеют архитектуру, которая позволяет эффективно использовать SIMD-инструкции.
\reflectbox{EUNN}-сети были добавлены в Stockfish в версии 10 в 2018 году,
и благодаря этому Stockfish стал самым лучшим свободно-распространяемым шахматным движком~\cite{tcec-superfinal}.
Оптимизация, которая возможна с помощью нейросетей, быстро превысила пределы человеческого кода,
и в версии Stockfish 16.1 режим HCE был полностью удален.

\subsection{Человеческий анализ}

Описанный выше подход поиска хороших позиций в игровом дереве
эффективно работает для машин,
но он совсем не похож на то, как человек думает про шахматы.
Как говорят многие гроссмейстеры и международные мастера~\cite{benfinegold-blundering-short}~\cite{gothamchess-patterns},
шахматы -- это не игра интеллекта, а игра на распознавание образов:
преимущество будет у того игрока, который видел больше позиций, похожих на текущую. 

Из-за этого человеческие шахматисты уделают особенное внимание
изучению дебютов: если идет партия с определенным дебютом,
то скорее всего победит тот, кто изучил все возможные вариации на двадцать и больше ходов,
чем тот, кто видит это впервые.
В свою очередь, из-за этого популярны так называемые <<неправильные>> или <<иррегулярные>> дебюты,
которые по строгому анализу (и с точки зрения компьютеров) являются ошибочными~\cite{chessbase-chess-openings},
потому что это может сбить противника с его подготовленных вариаций и тем самым запутать его.

Компьютерный и человеческий анализ несовместимы и по другим причинам,
и одной из важных среди них являются ходы, которые сложно понять или объяснить.
Сначала это выражалось в так называемых <<анти-компьютерных тактиках,>>
получивших известность во время матча Каспаров---Deep Blue~\cite{kasparov-anti-computer-chess}.
Сначала требуется вывести компьютер из исследованной территории,
например посредством одного из <<неправильных>> дебютов,
которые не будут встречаться в его базе данных.
После этого, анти-компьютерный стиль игры подразумевает пассивные, стратегические ходы,
так чтобы противник не заметил план по улучшению своей позиции ввиду органиченной глубины поиска.
Так, если компьютер ищет позиции в глубину в 10 полуходов, а задуманная стратегия даст преимущество через
12-20 полуходов, то компьютер не сможет увидеть и обойти угрозу.
Напротив, классические приемы против человека, вроде <<ловушек>> на 2-3 хода,
не работают против компьютеров.

Сейчас, когда компьютеры играют неизмеримо лучше человека,
мы встречаемся с противоположной проблемой,
когда компьютер может сделать ход,
смысл которого человек не может понять.
Самый известный пример такой ситуации возник в матче между Ли Сидолом и AlphaGo,
компьютерной программой по игре в Го от Google.
В одной из игр компьютер сыграл знаменитый <<ход 37,>>
который сначала показался зрителям ошибкой,
но затем оказался решающим для всей игры~\cite{wired-alphago}.

Также, такие необъяснимые ходы часто используются для обнаружения
мошенничиства, особенно в онлайн-играх:
Stockfish -- свободно распространяемое ПО,
и поэтому кто угодно может использовать его в онлайн-играх,
чтобы находить лучшие ходы и тем самым жульничать.
Однако Stockfish (и другие компьютерные движки)
имеют свойство в сложных позициях выбирать такие ходы, которые человек не выбрал бы,
потому что они не выглядят связанными с тем, что происходит на доске,
и имеют очень далеко идущие идеи.
Если человек играет такой неожиданный ход, и этот ход при этом
является одной из топ-рекомендаций Stockfish,
то это очень хороший индикатор, что человек жульничает,
и это могут заметить как высокорейтинговые игроки~\cite{gothamchess-cheater-exposed},
так и автоматические процессы~\cite{lichess-kaladin}.

\section{Шахматные варианты}

Ввиду своей долгой истории, было придумано много разных шахматных \emph{вариантов} --
игр, чьи правила основаны на шахматах, но отличаются от них в каких-то аспектах.
В этой части мы рассмотрим несколько таких вариантов, 
а также вкратце укажем, какие стратегии становятся предпочтительными в контексте таких правил.

\subsection{Chess960}

Также известный как <<шахматы Фишера>>, этот вариант
отличается от стандартных шахмат тем, что первая и восьмая горизонталь располагаются случайным образом,
сохраняя некоторые органичения (а именно что у короля должны быть ладьи на обоих сторонах и у каждой стороны должно быть два слона на разных цветах клетки) --
в результате этих ограничений, всего могут быть 960 начальных позиций.
Этот вариант был изобретен чемпионом мира Бобби Фишером в 1992 году~\cite{chess960}
в ответ на наблюдение, что игра в шахматы начала становиться скучной
из-за того, что гроссмейстеры заучивали дебюты 
и все игры были предсказуемыми.

Благодаря большому количеству начальных позиций, 
которые выбираются непредсказуемо (иногда даже полностью случайно),
выучить дебюты для каждой из этих начальных позиций
не представляется возможным.
Поэтому игрокам нужно опираться на базовые шахматные правила,
вроде выдвижения коней и слонов, контроля центра доски пешками,
а также защита короля:
последнее может быть сложно, потому что, в зависимости от расположения ладьей,
может не быть настолько защищенного места для рокировки, как в стандартных шахматах.
Так, если рокировка выводит короля к центру доски, а не к краю, то скорее всего ее не стоит делать.

\subsection{Бесконечные шахматы}

Этот вариант отличается от обычных шахмат тем, 
что доска не ограничена по высоте и ширине,
и фигуры могут двигаться выше восьмой и ниже первой горизонтали,
левее вертикали A и правее вертикали H.
Как следствие этого правила, пешки не могут быть продвинуты в другие фигуры, потому что нет границы, до которой они должны были бы продвинуться;
также отключаются правила \emph{взятия на проходе} и рокировки.

Бесконечные шахматы -- это обычно не игра, в которую играют люди, --
вместо этого это математическая структура, в которой можно находить интересные факты:
например, тот факт, что существуют такие позиции,
в которых гарантированна победа только в случае, когда игроки следуют
детерминистичной и вычислимой стратегии, а если снять это ограничение, то возможна ничья~\cite{transfinite-game-values} 
(что подтверждает теорему об ограниченности Тьюринг-машин без оракулов),
или тот факт, что задача о нахождении мата в $n$ ходов 
является решаемой для бесконечных шахмат~\cite{infinite-mate-in-n}
(что значит, что такая задача для обычных шахмат может иметь похожее решение).






\section{Список литературы}

\printbibliography

\end{document}